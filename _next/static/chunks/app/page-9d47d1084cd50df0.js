(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{66172:function(e,t,n){Promise.resolve().then(n.bind(n,9388))},9388:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eC}});var r=n(48499);n(2091);var a=n(38875),s=n(33448),o=n(44219),i=n(48740),l=n(10626),c=n(50059),d=n(89747),u=n(70828),f=n(39113),x=n(20071),h=n(31873),m=n(10631),p=n(13639),v=n(69479),g=n(6072),j=n(19701),b=n(39306),_=n(25142),y=n(90856),w=n(23102),Z=function(){let{trace:e}=(0,w.o)(),{showError:t,showSuccess:n}=(0,j.D)(),[s,o]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),u=e=>e.trim().startsWith("https://multisign.bitlayer.org/transactions/tx"),f=async()=>{if(u(s)){l(!0);try{await e({data:{tx_url:s.trim()}}),n("交易解析成功")}catch(e){var r,a,o;(null===(r=e.response)||void 0===r?void 0:r.status)===401?(localStorage.removeItem("safe_tx_analyzer_token"),window.dispatchEvent(new Event("auth:logout")),t("Token已过期,请重新登录")):(null===(a=e.response)||void 0===a?void 0:a.message)?t(null===(o=e.response)||void 0===o?void 0:o.message):t("请求失败")}finally{l(!1)}}};return(0,r.jsxs)(_.Z,{spacing:3,children:[(0,r.jsxs)(_.Z,{spacing:1,sx:{p:2,bgcolor:"info.lighter",borderRadius:1},children:[(0,r.jsx)(c.Z,{color:"info.main",fontWeight:"medium",children:"注意："}),(0,r.jsx)(c.Z,{color:"info.main",sx:{pl:2},children:"• 当前仅支持 BitLayer 链上的 Safe 交易通过 URL 来解析和模拟"}),(0,r.jsx)(c.Z,{color:"info.main",sx:{pl:2},children:"• 其它链上的 Safe 交易请使用普通交易解析模拟"}),(0,r.jsx)(c.Z,{color:"info.main",sx:{pl:2},children:"• 此功能为 BitLayer 链上的 Safe 交易提供便捷入口，可以显示交易详细信息（如：发起人、执行人、签名数等）"}),(0,r.jsx)(c.Z,{color:"info.main",sx:{pl:2},children:"• 当前也提供了签名交易功能，可以签名后提交到 Safe 合约，暂未提供执行交易功能。"})]}),(0,r.jsx)(d.Z,{required:!0,fullWidth:!0,label:"Safe 交易 URL",value:s,onChange:e=>o(e.target.value),placeholder:"https://multisign.bitlayer.org/transactions/tx?safe=&id=multisig_...",error:!!(s.trim()&&!u(s)),helperText:s.trim()&&!u(s)?"请输入有效的 Safe 交易 URL":"请输入Safe 交易的完整 URL"}),(0,r.jsx)(c.Z,{variant:"body2",color:"text.secondary",children:"URL 格式示例:https://multisign.bitlayer.org/transactions/tx/0x..."}),(0,r.jsx)(x.Z,{variant:"contained",onClick:f,disabled:i||!s.trim()||!u(s),fullWidth:!0,startIcon:i&&(0,r.jsx)(y.Z,{size:20,color:"inherit"}),children:i?"解析中 (预计需要60秒)...":"解析并模拟交易"})]})},C=function(){return(0,r.jsx)(l.Z,{elevation:2,children:(0,r.jsx)(i.Z,{sx:{p:3},children:(0,r.jsx)(Z,{})})})},k=n(70671),S=function(e){let{value:t,maxHeight:n="400px",maxWidth:a="100%"}=e,s=t.replace(/(# .+)/g,e=>e);return(0,r.jsx)(i.Z,{sx:{my:2,maxWidth:a,overflow:"hidden","& pre":{background:"#282c34",padding:"1em",margin:0,fontFamily:"monospace",fontSize:"14px",lineHeight:"1.5",color:"#e3e3e3",whiteSpace:"pre",overflowX:"auto",maxHeight:n,overflowY:"auto","&::-webkit-scrollbar":{width:"8px",height:"8px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"4px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},"&::-webkit-scrollbar-track":{backgroundColor:"rgba(0, 0, 0, 0.1)"},border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px"},"& .positive":{color:"#7bed9f",textShadow:"0 0 1px rgba(123, 237, 159, 0.3)"},"& .negative":{color:"#ff6b6b",textShadow:"0 0 1px rgba(255, 107, 107, 0.3)"},"& .warning":{color:"#ffd700",textShadow:"0 0 1px rgba(255, 215, 0, 0.3)"},"& .comment":{color:"#74b9ff",fontWeight:"bold",textShadow:"0 0 1px rgba(116, 185, 255, 0.3)"}},children:(0,r.jsx)("pre",{children:(0,k.ZP)(s)})})},T=function(){let e;let{result:t}=(0,w.o)();if(!t)return null;let n=(e,t)=>{let{basic_info:n,transaction_info:r,function_call:a}=e,s="";"Transfer"===r.type?s="Transfer ".concat(r.content.value):"ContractCreation"===r.type?s="Contract Creation".concat(r.content.contract_name?" (".concat(r.content.contract_name,")"):""):"ContractCall"===r.type&&(s="Contract Call to ".concat(r.content.contract_name||r.content.contract_address).concat(r.content.is_self_call?" (Self Call)":""));let o=a?"\nFunction: ".concat(a.name).concat(a.description?" (".concat(a.description,")"):"","\nParameters:").concat(a.parameters.map(e=>"\n  • ".concat(e.name).concat(e.description?" (".concat(e.description,")"):"","\n    Value: ").concat(e.display_value,"\n    Type:  ").concat(e.param_type.split("(")[0]).concat(e.token_info?"\n    Token: ".concat(e.token_info.symbol," (").concat(e.token_info.value,")"):"")).join("")):"";return"\n# Transaction ".concat(t,"\n----------------------------------------------------\nFrom:   ").concat(n.from,"\nTo:     ").concat(n.to||"N/A").concat(n.to_name?" (".concat(n.to_name,")"):"","\nValue:  ").concat(n.value,"\nType:   ").concat(s).concat(o)},a="".concat(t.safe_info?(e=t.safe_info,"\n# Safe Transaction Info\n----------------------------------------------------\nSafe Address:     ".concat(e.safe_address,"\nTransaction ID:   ").concat(e.tx_id,"\nTransaction Hash: ").concat(e.tx_hash,"\nNonce:           ").concat(e.nonce,"\nProposer:        ").concat(e.proposer,"\nExecutor:        ").concat(e.executor,"\nSignatures:      ").concat(e.confirmations.length," of ").concat(e.confirmations_required,"\nStatus:          ").concat((e=>{switch(e.toUpperCase()){case"SUCCESS":return'<span class="positive">SUCCESS</span>';case"FAILED":return'<span class="negative">FAILED</span>';case"PENDING":return'<span class="warning">PENDING</span>';default:return e}})(e.status),"\nBlock Number:    ").concat(e.block_number)+"\n\n"):"").concat(t.decoded_info.map((e,t)=>n(e,t+1)).join("\n\n"));return(0,r.jsx)(l.Z,{elevation:2,children:(0,r.jsxs)(i.Z,{sx:{p:3},children:[(0,r.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"交易参数解析结果"}),(0,r.jsx)(S,{value:a})]})})},I=n(10506),P=n(55645),E=n(41552),A=n(13400),L=n(13643),R=n(11039),W=n(47013),z=n(57018),F=n(65382),B=n(88245),D=n(30739),N=n(53726),H=n(99384),O=n(13377),M=n(14224);function U(e){let{trace:t,index:n,level:s,expandedPath:o,resetCounter:l,onReset:d,isFirstInLevel:u=!0}=e,[x,h]=(0,a.useState)(!1),m=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(0===o.length){h(!1);return}if(o.length>0){let e=t.trace_address;e.every((e,t)=>e===o[t])&&(h(!0),e.length===o.length&&setTimeout(()=>{var e;let t=null===(e=m.current)||void 0===e?void 0:e.closest(".MuiDialogContent-root");if(t&&m.current){let e=t.clientHeight,n=m.current.offsetTop-e/4;t.scrollTo({top:Math.max(0,n),behavior:"smooth"})}},150))}},[o,t.trace_address]);let p=(e,t)=>t.length>130?'"'.concat(e,'": "').concat(t.slice(0,130),'..."'):'"'.concat(e,'": "').concat(t,'"'),v=(e,t)=>{let n="  ".repeat(Math.max(0,e-1));return t?"".concat(n).concat("> ".repeat(e)):"".concat(n).concat("  ".repeat(e))},g="Success"!==t.status&&"InProgress"!==t.status;return(0,r.jsxs)(i.Z,{ref:m,sx:{display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(i.Z,{sx:{display:"flex",alignItems:"flex-start",mb:1,position:"relative"},children:[g&&(0,r.jsx)(i.Z,{sx:{position:"absolute",left:-20,top:12,color:"#d32f2f",fontSize:"0.85em",lineHeight:1,zIndex:1},children:"❌"}),t.subtraces.length>0&&(0,r.jsx)(f.Z,{size:"small",onClick:()=>h(!x),sx:{mt:.5,mr:1,minWidth:28,color:"primary.main","&:hover":{color:"primary.dark"}},children:x?(0,r.jsx)(B.Z,{}):(0,r.jsx)(D.Z,{})}),0===t.subtraces.length&&(0,r.jsx)(i.Z,{sx:{width:36}}),(0,r.jsx)(c.Z,{component:"pre",sx:{fontFamily:"monospace",backgroundColor:g?"error.lighter":"action.hover",p:1,borderRadius:1,flexGrow:1,maxWidth:"calc(100% - 36px)",overflowX:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all"},dangerouslySetInnerHTML:{__html:"".concat(v(s,u),"{\n").concat((()=>{let e="",n="  ".repeat(Math.max(0,s-1))+"  ".repeat(s+1);e+="".concat(n,'"type": "').concat(q(t),'",\n')+"".concat(n,'"from": "').concat(t.from,'",\n')+"".concat(n,'"to": "').concat(t.to,'",\n')+"".concat(n,'"value": "').concat(t.value||"0x0",'",\n')+"".concat(n,'"gas_used": ').concat(parseInt(t.gas_used||"0x0"),",\n");let r=p("input",t.input);if(e+="".concat(n).concat(r,",\n"),t.output){let r=p("output",t.output);e+="".concat(n).concat(r)}if("Success"!==t.status&&"InProgress"!==t.status){let r="object"==typeof t.status?"Revert"in t.status?"Revert:".concat(t.status.Revert):"Halt:".concat(t.status.Halt,")"):t.status;e+=",\n".concat(n,'<span style="background-color: rgba(255, 0, 0, 0.3)">"status": "').concat("object"==typeof t.status?"".concat(r):r,'"</span>')}return e})(),"\n").concat(v(s,!1),"}")}})]}),(0,r.jsx)(R.Z,{in:x,sx:{width:"100%"},children:t.subtraces.map((e,t)=>(0,r.jsx)(U,{trace:e,index:t,level:s+1,expandedPath:o,resetCounter:l,onReset:d,isFirstInLevel:0===t},"".concat(n,"-").concat(t)))})]})}var G=function(e){let{open:t,onClose:n,traceResult:s,error_trace_address:o}=e,{showSuccess:l,showError:d}=(0,j.D)(),[u,f]=(0,a.useState)(0),[h,m]=(0,a.useState)([]),p=()=>{m([]),f(e=>e+1),n()};return s?(0,r.jsxs)(W.Z,{open:t,onClose:p,maxWidth:!1,fullWidth:!0,PaperProps:{sx:{width:"1920px",maxWidth:"90%",height:"calc(100% - 64px)","& .MuiDialogContent-root":{overflowY:"auto"}}},children:[(0,r.jsx)(z.Z,{children:(0,r.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(c.Z,{variant:"h6",component:"div",children:"调用层级"}),(0,r.jsxs)(i.Z,{sx:{display:"flex",gap:1},children:[o&&(0,r.jsx)(x.Z,{startIcon:(0,r.jsx)(N.Z,{}),onClick:()=>{o&&m(o)},variant:"outlined",color:"error",size:"small",children:"定位错误"}),(0,r.jsx)(x.Z,{startIcon:(0,r.jsx)(H.Z,{}),onClick:()=>{let e=JSON.stringify(s.call_traces,null,2);navigator.clipboard.writeText(e).then(()=>l("复制成功")).catch(()=>d("复制失败"))},variant:"outlined",size:"small",children:"复制内容"}),(0,r.jsx)(x.Z,{startIcon:(0,r.jsx)(O.Z,{}),onClick:()=>{m([]),f(e=>e+1)},variant:"outlined",size:"small",children:"重置展开"}),(0,r.jsx)(x.Z,{startIcon:(0,r.jsx)(M.Z,{}),onClick:p,variant:"outlined",size:"small",children:"关闭"})]})]})}),(0,r.jsx)(F.Z,{children:s.call_traces.map((e,t)=>(0,r.jsx)(U,{trace:e,index:t,level:0,expandedPath:h,resetCounter:u,onReset:()=>f(u+1),isFirstInLevel:!0},t))})]}):null};let q=e=>{if(e.call_scheme)return e.call_scheme;if(e.create_scheme){if("string"==typeof e.create_scheme)return e.create_scheme;if("Create2"in e.create_scheme)return"Create2 (Salt: ".concat(e.create_scheme.Create2.salt,")")}return'<span style="color: #ff9800">Unknown Scheme</span>'};var J=function(e){var t,n,s,o,l,d,u,f,h,m,p;let{result:v,traceResult:g}=e,[b,_]=(0,a.useState)(!1),{showSuccess:y,showError:w}=(0,j.D)(),{requestSignature:Z}=(0,E.O)(),{address:C,isConnected:k}=(0,A.m)(),S=async()=>{if(null==v?void 0:v.safe_info){if(!k||!C){w("请先连接钱包");return}if(!v.safe_info.signers.map(e=>e.toLowerCase()).includes(C.toLowerCase())){w("您不是签名者，无法签名");return}if(v.safe_info.confirmations.some(e=>e.signer.toLowerCase()===C.toLowerCase())){w("当前地址已经签名过该交易");return}try{let e=await Z({safeAddress:v.safe_info.safe_address,safeTxHash:v.safe_info.tx_id,safeTx:v.safe_info.safe_tx}),t=v.safe_info.confirmations.concat([{signer:C,signature:e}]).sort((e,t)=>e.signer.localeCompare(t.signer)).map((e,t)=>0===t?e.signature:e.signature.replace(/^0x/,"")).join(""),n={...v.safe_info.safe_tx,value:parseInt(v.safe_info.safe_tx.value,16).toString(),safeTxGas:parseInt(v.safe_info.safe_tx.safeTxGas,16).toString(),baseGas:parseInt(v.safe_info.safe_tx.baseGas,16).toString(),gasPrice:parseInt(v.safe_info.safe_tx.gasPrice,16).toString(),nonce:parseInt(v.safe_info.safe_tx.nonce,16).toString(),safe:v.safe_info.safe_address,signature:t,sender:C,safeTxHash:v.safe_info.tx_id};try{await L.h.proposeSafeTx(v.safe_info.safe_address,n),y("交易签名并提交成功")}catch(e){w("交易签名提交失败:"+e)}}catch(e){e instanceof Error?"Transaction hash verification failed"===e.message?w("交易数据验证失败，请检查交易信息"):e.message.includes("switch to BitLayer")?w("请切换到 BitLayer 网络后再试"):e.message.includes("No ethereum wallet found")?w("请先安装并连接钱包"):w("签名失败："+e.message):w("签名失败：未知错误")}}},T=(null==v?void 0:null===(n=v.safe_info)||void 0===n?void 0:null===(t=n.status)||void 0===t?void 0:t.toUpperCase())==="AWAITING_CONFIRMATIONS"||(null==v?void 0:null===(o=v.safe_info)||void 0===o?void 0:null===(s=o.status)||void 0===s?void 0:s.toUpperCase())==="CANCELED",R=(null!==(m=null==v?void 0:null===(d=v.safe_info)||void 0===d?void 0:null===(l=d.confirmations)||void 0===l?void 0:l.length)&&void 0!==m?m:0)<(null!==(p=null==v?void 0:null===(u=v.safe_info)||void 0===u?void 0:u.confirmations_required)&&void 0!==p?p:0);return(0,r.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,r.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mr:2},children:"模拟交易结果"}),v&&v.trace_info?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(c.Z,{color:V(v.trace_info.status),sx:{mr:1},children:X(v.trace_info.status,v.trace_info.error_message)})}):(0,r.jsx)(c.Z,{color:"text.secondary",children:"未进行模拟交易"})]}),(0,r.jsxs)(i.Z,{sx:{display:"flex",gap:1},children:[(null==v?void 0:null===(f=v.safe_info)||void 0===f?void 0:f.status)&&(0,r.jsx)(x.Z,{variant:"outlined",startIcon:(0,r.jsx)(P.Z,{}),onClick:S,size:"small",color:"warning",disabled:!(R&&T),sx:{mr:2},children:"签名交易"}),(null==v?void 0:v.trace_info)&&(0,r.jsx)(x.Z,{variant:"outlined",startIcon:(0,r.jsx)(I.Z,{}),onClick:()=>{_(e=>!e)},size:"small",children:"显示调用层级"})]}),(0,r.jsx)(G,{open:b,onClose:()=>_(!1),error_trace_address:null==v?void 0:null===(h=v.trace_info)||void 0===h?void 0:h.error_trace_address,traceResult:g})]})};let V=e=>"Success"in e?"success.main":"error.main",X=(e,t)=>{let n="Success"in e?"模拟交易执行成功.":"模拟交易执行失败.";return t&&(n+=" 初始错误信息: ".concat(Y(t))),n},Y=e=>e.startsWith("0x")?"".concat(e.slice(0,10),"..."):e;var K=n(61161);let Q="0x0000000000000000000000000000000000000000";function $(e,t,n,r,a){e[t]||(e[t]={}),e[t][n]||(e[t][n]={value:K.yT(0),isPositive:!0});let s=e[t][n];a?s.isPositive?(s.value=s.value+r,s.isPositive=!0):s.value<=r?(s.value=r-s.value,s.isPositive=!0):(s.value=s.value-r,s.isPositive=!1):s.isPositive?s.value>=r?(s.value=s.value-r,s.isPositive=!0):(s.value=r-s.value,s.isPositive=!1):(s.value=s.value+r,s.isPositive=!1)}var ee=n(51215),et=n(72933);let en=(0,et.ZP)(i.Z)(e=>{let{theme:t}=e;return{fontFamily:"monospace",whiteSpace:"pre",marginTop:t.spacing(2)}}),er=(0,et.ZP)(c.Z)(e=>{let{theme:t}=e;return{color:t.palette.info.main,fontWeight:"bold",marginBottom:t.spacing(1)}}),ea=(0,et.ZP)(i.Z)({display:"flex",alignItems:"center",height:"24px"}),es=(0,et.ZP)(c.Z)({width:"48ch",fontFamily:"monospace",paddingRight:"10ch"}),eo=(0,et.ZP)(c.Z)({width:"20ch",fontFamily:"monospace",paddingRight:"5ch"}),ei=(0,et.ZP)(c.Z)({width:"14ch",fontFamily:"monospace",textAlign:"left"});function el(e){let{rows:t}=e;return(0,r.jsxs)(en,{children:[(0,r.jsx)(er,{variant:"subtitle1",color:"info",sx:{marginTop:-3,marginBottom:3},children:"余额变化列表"}),(0,r.jsxs)(ea,{sx:{marginBottom:2},children:[(0,r.jsx)(es,{children:"地址"}),(0,r.jsx)(eo,{children:"代币"}),(0,r.jsx)(ei,{children:"变化值"})]}),(0,r.jsx)(i.Z,{sx:{height:1,bgcolor:"divider",my:1}}),t.map((e,n)=>(0,r.jsx)(i.Z,{sx:{mb:n<t.length-1?2:0},children:e.tokens.map((t,n)=>(0,r.jsxs)(ea,{children:[0===n?(0,r.jsx)(es,{children:e.address.toLowerCase()}):(0,r.jsx)(es,{children:""}),(0,r.jsx)(eo,{children:t.symbol}),(0,r.jsxs)(ei,{color:t.isPositive?"success.main":"error.main",children:[t.isPositive?"+":"-",t.value]})]},"".concat(e.address,"-").concat(t.symbol)))},e.address))]})}var ec=function(e){let{traceResult:t}=e,n=(()=>{let e=function(e){let t={};return e.forEach(e=>{let n=K.yT(e.value);e.from!==Q&&$(t,e.from,e.token,n,!1),e.to!==Q&&$(t,e.to||"合约创建失败",e.token,n,!0)}),t}(t.asset_transfers),n=t.token_infos;return Object.entries(e).map(e=>{let[t,r]=e;return{address:t,tokens:Object.entries(r).map(e=>{let[t,{value:r,isPositive:a}]=e,s=(null==n?void 0:n[t])||{symbol:"unknown",decimals:18},o=Number(ee.bM(r,s.decimals));return 0===o?null:{symbol:s.symbol,value:o.toFixed(s.decimals),isPositive:a}}).filter(e=>null!==e)}}).filter(e=>e.tokens.length>0)})();return n.length>0?(0,r.jsx)(el,{rows:n}):(0,r.jsx)(i.Z,{sx:{p:2,textAlign:"center",border:"1px solid #f0f0f0",borderRadius:1},children:(0,r.jsx)(c.Z,{color:"text.secondary",children:"此模拟交易没有余额变化"})})},ed=n(23645),eu=n(70984),ef=n(26394),ex=function(e){var t;let{traceResult:n}=e,[s,o]=(0,a.useState)(!1),l=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useRef)(null),x=(0,a.useRef)(null),{showSuccess:h,showError:m}=(0,j.D)(),p=e=>e?e.length<=10?e:"".concat(e.slice(0,6),"...").concat(e.slice(-4)):"",v=(0,a.useCallback)((e,t,n)=>{let r=new ed.kJ({container:e,width:t,height:n,autoFit:"view",padding:[20,20,20,20],node:{type:"rect",style:{size:[240,64],radius:8,fill:"#5195ff",stroke:"#fff",lineWidth:1,labelFontSize:18,labelText:e=>{var t;return p(null===(t=e.data)||void 0===t?void 0:t.label)},labelPlacement:"center"}},edge:{type:"quadratic",style:{labelBackground:!0,endArrow:!0,endArrowOffset:20,labelFontSize:18,labelText:e=>e.data?e.data.label:""}},layout:{type:"antv-dagre",rankdir:"LR",ranksep:180,nodesep:120},behaviors:["click-select","drag-element","drag-canvas","zoom-canvas"],transforms:[{type:"process-parallel-edges",distance:55,offset:35,loop:{distance:50},thickness:25}]});return r.on(ed.bG.CLICK,e=>{let t=e.target.id;try{navigator.clipboard.writeText(t),h("地址已复制到剪贴板")}catch(e){m("复制失败: "+e.message)}}),r},[m,h]),g=(0,a.useCallback)((e,t,n)=>v(e,t,n),[v]),b=(0,a.useMemo)(()=>{var e;return(null==n?void 0:null===(e=n.asset_transfers)||void 0===e?void 0:e.length)>0},[null==n?void 0:null===(t=n.asset_transfers)||void 0===t?void 0:t.length]),_=(0,a.useCallback)(e=>{n&&e&&setTimeout(()=>{if(e.destroyed)return;let t=function(e,t){let n=new Map,r=[];return e.forEach((e,a)=>{n.has(e.from)||n.set(e.from,{id:e.from,data:{label:e.from,address:e.from}}),n.has(e.to||"合约创建失败")||n.set(e.to||"合约创建失败",{id:e.to||"合约创建失败",data:{label:e.to||"合约创建失败",address:e.to||"合约创建失败"}});let s=t[e.token],o=Number(ee.bM(e.value,s.decimals)).toFixed(6);r.push({id:(0,ef.Z)(),source:e.from,target:e.to||"合约创建失败",data:{label:"(".concat(a+1,")  ").concat(o,"  ").concat(s.symbol)}})}),{nodes:Array.from(n.values()),edges:r}}(n.asset_transfers,n.token_infos||{});e.setData(t),e.render()},100)},[n]);return(0,a.useEffect)(()=>{let e=null;return b&&(e=(()=>{if(!l.current)return null;try{return g(l.current,l.current.offsetWidth,400)}catch(e){return null}})())&&(u.current=e,_(e)),()=>{if(e&&!e.destroyed)try{e.destroy()}catch(e){console.error("Error destroying graph:",e)}u.current=null}},[b,g,_]),(0,r.jsxs)(i.Z,{children:[(0,r.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,r.jsx)(c.Z,{variant:"subtitle1",children:"资金流向图"}),b&&(0,r.jsx)(f.Z,{onClick:()=>o(!0),size:"small",title:"查看大图",children:(0,r.jsx)(eu.Z,{})})]}),b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{ref:l,sx:{height:400,border:"1px solid #f0f0f0",borderRadius:1,overflow:"hidden"}}),(0,r.jsx)(W.Z,{open:s,onClose:()=>o(!1),maxWidth:"xl",fullWidth:!0,TransitionProps:{onEntered:()=>{let e=d.current;if(!e)return;let t=v(e,e.offsetWidth,e.offsetHeight);x.current=t,_(t)},onExit:()=>{x.current&&(x.current.destroy(),x.current=null)}},children:(0,r.jsx)(F.Z,{sx:{height:"80vh",p:0,bgcolor:"background.paper"},children:(0,r.jsx)(i.Z,{ref:d,sx:{width:"100%",height:"100%"}})})})]}):(0,r.jsx)(i.Z,{sx:{height:400,border:"1px solid #f0f0f0",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(c.Z,{color:"text.secondary",children:"此模拟交易没有资金转移"})})]})},eh=n(87396),em=n(80300),ep=n(34713),ev=n(37370),eg=n(58504),ej=n(86430),eb=function(e){let{logs:t}=e;return t&&0!==t.length?(0,r.jsxs)(i.Z,{children:[(0,r.jsx)(c.Z,{variant:"h6",sx:{mb:2},children:"事件日志"}),(0,r.jsx)(eh.Z,{children:(0,r.jsxs)(em.Z,{size:"small",children:[(0,r.jsx)(ep.Z,{children:(0,r.jsxs)(ev.Z,{children:[(0,r.jsx)(eg.Z,{children:"合约地址"}),(0,r.jsx)(eg.Z,{children:"Topics"}),(0,r.jsx)(eg.Z,{children:"Data"})]})}),(0,r.jsx)(ej.Z,{children:t.map((e,t)=>(0,r.jsxs)(ev.Z,{children:[(0,r.jsx)(eg.Z,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:e.address}),(0,r.jsx)(eg.Z,{children:(0,r.jsx)(i.Z,{sx:{maxWidth:300,overflow:"hidden"},children:e.topics.map((e,t)=>(0,r.jsx)(c.Z,{variant:"body2",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e},t))})}),(0,r.jsx)(eg.Z,{sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.data||"-"})]},t))})]})})]}):(0,r.jsx)(i.Z,{sx:{p:2,textAlign:"center"},children:(0,r.jsx)(c.Z,{color:"text.secondary",children:"没有日志数据"})})},e_=JSON.parse('{"p":[{"name":"Ethereum","chain_id":1,"symbol":"ETH","decimals":18,"rpc_url":"https://rpc.ankr.com/eth","multi_send_call_only":"0xA1dabEF33b3B82c7814B6D82A79e50F4AC44102B","wrap_token":"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2","wrap_token_symbol":"WETH"},{"name":"BitLayer","chain_id":200901,"symbol":"BTC","decimals":18,"rpc_url":"https://rpc.bitlayer.org","multi_send_call_only":"0x40A2aCCbd92BCA938b02010E17A5b8929b49130D","wrap_token":"0xff204e2681a6fa0e2c3fade68a1b28fb90e4fc5f","wrap_token_symbol":"WBTC"},{"name":"BitLayerTestnet","chain_id":200810,"symbol":"BTC","decimals":18,"rpc_url":"https://testnet-rpc.bitlayer.org","multi_send_call_only":"0x40A2aCCbd92BCA938b02010E17A5b8929b49130D","wrap_token":"0x3e57d6946f893314324c975aa9cebbdf3232967e","wrap_token_symbol":"WBTC"}]}'),ey=function(){let e;let{result:t}=(0,w.o)(),n=e_.p.find(e=>200901===e.chain_id);if(!(null==t?void 0:t.trace_info)||!n)return null;try{var a,s;let r=Object.entries(null!==(s=null==t?void 0:null===(a=t.trace_info)||void 0===a?void 0:a.token_infos)&&void 0!==s?s:{}).reduce((e,t)=>{let[n,r]=t;return{...e,[n.toLowerCase()]:r}},{}),o=(function(e,t){var n;let r=[...e.asset_transfers].filter(e=>"0x0"!==e.value),a={...e.token_infos},s=null===(n=t.wrap_token)||void 0===n?void 0:n.toLowerCase();for(let e=r.length-1;e>=0;e--){let n=r[e];if("0x0000000000000000000000000000000000000000"===n.token&&s&&n.to===s){let o={token:s,from:s,to:n.from,value:n.value};r.splice(e+1,0,o),!a[s]&&t.wrap_token_symbol&&(a[s]={symbol:t.wrap_token_symbol,decimals:t.decimals})}}return{...e,asset_transfers:r,token_infos:a}})(t.trace_info,n).asset_transfers.map(e=>{var t;return{...e,token:e.token.toLowerCase(),from:e.from.toLowerCase(),to:(null===(t=e.to)||void 0===t?void 0:t.toLowerCase())||"合约创建失败"}});e={...null==t?void 0:t.trace_info,token_infos:r,asset_transfers:o}}catch(e){return console.error("Error processing trace result:",e),null}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{sx:{mb:2},children:(0,r.jsx)(J,{traceResult:e,result:t})}),(0,r.jsxs)(_.Z,{spacing:2,children:[(0,r.jsx)(l.Z,{elevation:2,children:(0,r.jsx)(i.Z,{sx:{p:3},children:(0,r.jsx)(ex,{traceResult:e})})}),(0,r.jsx)(l.Z,{elevation:2,children:(0,r.jsx)(i.Z,{sx:{p:3},children:(0,r.jsx)(ec,{traceResult:e})})}),(0,r.jsx)(l.Z,{elevation:2,children:(0,r.jsx)(i.Z,{sx:{p:3},children:(0,r.jsx)(eb,{logs:t.trace_info.logs||[]})})})]})]})},ew=n(33767);function eZ(){var e,t;let[n,h]=(0,a.useState)(!1),[m,b]=(0,a.useState)(!1),{login:_}=(0,g.a)(),{showError:y,showSuccess:w}=(0,j.D)(),{register:Z,handleSubmit:C,formState:{errors:k}}=(0,s.cI)({defaultValues:{username:"",password:""},mode:"onChange"}),S=async e=>{b(!0);try{await _(e.username,e.password),w("登录成功")}catch(e){var t,n;y((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"登录失败,请检查用户名和密码")}finally{b(!1)}};return(0,r.jsx)(o.Z,{maxWidth:"sm",children:(0,r.jsx)(i.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsxs)(l.Z,{elevation:3,sx:{p:4,width:"100%"},children:[(0,r.jsx)(c.Z,{variant:"h5",component:"h1",gutterBottom:!0,textAlign:"center",children:"登录"}),(0,r.jsxs)("form",{onSubmit:C(S),children:[(0,r.jsx)(d.Z,{fullWidth:!0,label:"用户名",margin:"normal",error:!!k.username,helperText:null===(e=k.username)||void 0===e?void 0:e.message,...Z("username",{required:"用户名是必填项",minLength:{value:3,message:"用户名至少需要3个字符"},maxLength:{value:20,message:"用户名不能超过20个字符"},pattern:{value:/^[a-zA-Z0-9_-]+$/,message:"用户名只能包含字母、数字、下划线和横线"}})}),(0,r.jsx)(d.Z,{fullWidth:!0,label:"密码",type:n?"text":"password",margin:"normal",error:!!k.password,helperText:null===(t=k.password)||void 0===t?void 0:t.message,...Z("password",{required:"密码是必填项",minLength:{value:6,message:"密码长度至少为6个字符"}}),slotProps:{input:{endAdornment:(0,r.jsx)(u.Z,{position:"end",children:(0,r.jsx)(f.Z,{onClick:()=>h(!n),edge:"end",children:n?(0,r.jsx)(p.Z,{}):(0,r.jsx)(v.Z,{})})})}}}),(0,r.jsx)(x.Z,{fullWidth:!0,type:"submit",variant:"contained",sx:{mt:3},disabled:m,children:m?"登录中...":"登录"})]})]})})})}function eC(){let{token:e}=(0,g.a)();return e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek,{}),(0,r.jsxs)(o.Z,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,r.jsx)(C,{}),(0,r.jsx)(i.Z,{sx:{my:4},children:(0,r.jsx)(T,{})}),(0,r.jsx)(i.Z,{sx:{my:4},children:(0,r.jsx)(ey,{})})]})]}):(0,r.jsx)(eZ,{})}function ek(){return(0,r.jsx)(h.Z,{position:"static",sx:{backgroundColor:"#1976d2"},children:(0,r.jsxs)(m.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,r.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(f.Z,{edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},children:(0,r.jsx)(ew.Z,{})}),(0,r.jsx)(c.Z,{variant:"h6",component:"div",children:"Safe交易参数检查与结果模拟"})]}),(0,r.jsx)(b.NL,{})]})})}},6072:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return l}});var r=n(48499),a=n(38875),s=n(13643);let o=(0,a.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,a.useState)(()=>localStorage.getItem("safe_tx_analyzer_token")),l=()=>{i(null),localStorage.removeItem("safe_tx_analyzer_token")},c=async(e,t)=>{try{let{data:{token:n}}=await s.h.login({username:e,password:t});i(n),localStorage.setItem("safe_tx_analyzer_token",n)}catch(e){throw e}};return(0,a.useEffect)(()=>{let e=()=>{l()};return window.addEventListener("auth:logout",e),()=>{window.removeEventListener("auth:logout",e)}},[]),(0,r.jsx)(o.Provider,{value:{token:n,login:c,logout:l},children:t})}function l(){let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},19701:function(e,t,n){"use strict";n.d(t,{D:function(){return c},w:function(){return l}});var r=n(48499),a=n(38875),s=n(7646),o=n(93866);let i=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[n,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[u,f]=(0,a.useState)("success"),x=(e,t)=>{d(e),f(t),l(!0)};return(0,r.jsxs)(i.Provider,{value:{showError:e=>x(e,"error"),showSuccess:e=>x(e,"success"),showInfo:e=>x(e,"info")},children:[t,(0,r.jsx)(s.Z,{open:n,autoHideDuration:3e3,onClose:()=>l(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{bottom:{xs:16,sm:24}},children:(0,r.jsx)(o.Z,{severity:u,onClose:()=>l(!1),variant:"filled",sx:{minWidth:"280px",boxShadow:2,"& .MuiAlert-icon":{fontSize:"1.25rem"},"& .MuiAlert-message":{fontSize:"0.95rem",padding:"8px 0"},"& .MuiAlert-action":{padding:"0 8px"}},children:c})})]})}let c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useSnackbar must be used within SnackbarProvider");return e}},23102:function(e,t,n){"use strict";n.d(t,{o:function(){return l},z:function(){return i}});var r=n(48499),a=n(38875),s=n(13643);let o=(0,a.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,a.useState)(null),l=async e=>{try{let t=await s.h.traceSafe(e.data);i(t.data)}catch(e){throw i(null),e}};return(0,r.jsx)(o.Provider,{value:{result:n,trace:l,reset:()=>{i(null)}},children:t})}function l(){let e=(0,a.useContext)(o);if(!e)throw Error("useTrace must be used within a TraceProvider");return e}},41552:function(e,t,n){"use strict";n.d(t,{O:function(){return d},n:function(){return c}});var r=n(48499),a=n(38875),s=n(6496),o=n(21881),i=n(90427);let l=(0,a.createContext)(null);function c(e){let{children:t}=e,n=(0,i.x)(),c=(0,a.useCallback)(async e=>{if(!window.ethereum)throw Error("No ethereum wallet found");if(200901!==n)throw Error("Please switch to BitLayer network (Chain ID: ".concat(200901,")"));let t={chainId:200901,verifyingContract:e.safeAddress},r={SafeTx:[{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"operation",type:"uint8"},{name:"safeTxGas",type:"uint256"},{name:"baseGas",type:"uint256"},{name:"gasPrice",type:"uint256"},{name:"gasToken",type:"address"},{name:"refundReceiver",type:"address"},{name:"nonce",type:"uint256"}]};if(s.E.hash(t,r,e.safeTx)!==e.safeTxHash)throw Error("Transaction hash verification failed");let a=new o.Q(window.ethereum),i=await a.getSigner();try{return await i.signTypedData(t,r,e.safeTx)}catch(e){throw console.error("Signing failed:",e),e}},[n]);return(0,r.jsx)(l.Provider,{value:{requestSignature:c},children:t})}function d(){let e=(0,a.useContext)(l);if(!e)throw Error("useWallet must be used within a WalletProvider");return e}},13643:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var r=n(17558);let a=r.Z.create({baseURL:"https://api.aegisweb.xyz/api/decode/external",timeout:3e5,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("safe_tx_analyzer_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let s={login:e=>a.post("/login",e),traceSafe:e=>a.post("/auth/trace/safe",e),proposeSafeTx:(e,t)=>r.Z.post("/api/safe/propose",{safeAddress:e,signedTx:t})}}},function(e){e.O(0,[2221,5488,685,9022,6398,2456,223,2617,1744],function(){return e(e.s=66172)}),_N_E=e.O()}]);